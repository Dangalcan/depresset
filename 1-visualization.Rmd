---
title: "Depresset. Grupo 5. Visualización"
author: "Daniel Galván Cancio, Daniel Vela Gamacho, Jaime Linares Barrera, Miguel Encina Martinez"
output: html_document
---

# Proyecto sobre la depresión estudiantil

```{r cars}
  library(readr)
  library(tidyr)
  library(tidyverse)
  library(dplyr)
  library(ggplot2)
  library(lubridate)
  library(gapminder)
  library(plotly)

```


```{r cars}
  # leer el csv
  ds <- read.csv("./data/student_depression_dataset.csv",sep=",")
  head(ds)
  dim(ds)

```

## Depresión por sexo

```{r cars}

  depresion_por_sexo <- ds %>%
  group_by(Gender) %>%
  summarise(
    Numero_Estudiantes_Deprimidos = sum(Depression == 1, na.rm = TRUE),
    Numero_Estudiantes_No_Deprimidos = sum(Depression == 0, na.rm = TRUE)
  ) %>%
  mutate(
    Total = Numero_Estudiantes_Deprimidos + Numero_Estudiantes_No_Deprimidos,
    Porcentaje_Deprimidos = 100 * Numero_Estudiantes_Deprimidos / Total,
    Porcentaje_No_Deprimidos = 100 * Numero_Estudiantes_No_Deprimidos / Total
  )

  depresion_por_sexo_masculino <- depresion_por_sexo %>%
    filter(Gender == "Male")

  depresion_por_sexo_femenino <- depresion_por_sexo %>%
    filter(Gender == "Female")

  # Pie chart de varones deprimidos vs no deprimidos
  plot_ly(depresion_por_sexo_masculino, labels = ~c('Deprimidos', 'No Deprimidos'),
          values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
          textposition = 'inside',
          textinfo = 'label+percent') %>%
    layout(title = 'Estudiantes Masculinos Deprimidos vs No Deprimidos',
          xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
          yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

  # Pie chart de mujeres deprimidas vs no deprimidas
  plot_ly(depresion_por_sexo_femenino, labels = ~c('Deprimidos', 'No Deprimidos'),
          values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
          textposition = 'inside',
          textinfo = 'label+percent') %>%
    layout(title = 'Estudiantes Femeninos Deprimidos vs No Deprimidos',
          xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
          yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))


  # Pie chart de porcentaje de estudiantes deprimidos por género
  plot_ly(depresion_por_sexo, labels = ~Gender, values = ~Porcentaje_Deprimidos, type = 'pie',
          textposition = 'inside',
          textinfo = 'label+percent') %>%
    layout(title = 'Porcentaje de Estudiantes Deprimidos por Género',
          xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
          yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

```

## Depresión por profesión

```{r cars}

profesions <- ds %>%
  group_by(Profession) %>%
  summarise(Count = n())

profesions

ggplot(profesions, aes(x = reorder(Profession, -Count), y = Count)) +
  geom_bar(stat = "identity", fill = "coral") +
  labs(title = "Número de Personas por Profesión",
       x = "Profesión",
       y = "Número de Personas") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

## Depresión por ciudad

```{r cars}

depresion_por_ciudades <- ds %>%
  filter(Depression == 1 & Profession == "Student") %>%
  group_by(City) %>%
  summarise(Numero_Estudiantes_Deprimidos = n()) %>%
  arrange(desc(Numero_Estudiantes_Deprimidos))

depresion_por_ciudades

ggplot(depresion_por_ciudades, aes(x = reorder(City, -Numero_Estudiantes_Deprimidos), y = Numero_Estudiantes_Deprimidos)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(title = "Ciudades con más Estudiantes Deprimidos",
       x = "Ciudad",
       y = "Número de Estudiantes Deprimidos") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```
## Depresión por sexo en estudiantes

```{r cars}
depresion_por_sexo <- ds %>%
  filter(Profession == "Student") %>%
  group_by(Gender) %>%
  summarise(
    Numero_Estudiantes_Deprimidos = sum(Depression == 1, na.rm = TRUE),
    Numero_Estudiantes_No_Deprimidos = sum(Depression == 0, na.rm = TRUE)
  ) %>%
  mutate(
    Total = Numero_Estudiantes_Deprimidos + Numero_Estudiantes_No_Deprimidos,
    Porcentaje_Deprimidos = 100 * Numero_Estudiantes_Deprimidos / Total,
    Porcentaje_No_Deprimidos = 100 * Numero_Estudiantes_No_Deprimidos / Total
  )

depresion_por_sexo
```

## Depresión por nivel de estudios en estudiantes

Hemos encontrado que la variable nivel de estudios tiene distintos valores, por lo que en el preprocesado deberemos abordar esto unificando unos valores categóricos con orden

```{r cars}

depresion_por_nivel_estudio <- ds %>%
  filter(Profession == "Student") %>%
  group_by(Degree) %>%
  summarise(
    Numero_Estudiantes_Deprimidos = sum(Depression == 1, na.rm = TRUE),
    Numero_Estudiantes_No_Deprimidos = sum(Depression == 0, na.rm = TRUE)
  ) %>%
  mutate(
    Total = Numero_Estudiantes_Deprimidos + Numero_Estudiantes_No_Deprimidos,
    Porcentaje_Deprimidos = 100 * Numero_Estudiantes_Deprimidos / Total,
    Porcentaje_No_Deprimidos = 100 * Numero_Estudiantes_No_Deprimidos / Total
  )
  
depresion_por_nivel_estudio
```
# Depresión por edad 

```{r cars}
depresion_por_edad <- ds %>%
  filter(Profession == "Student") %>%
  group_by(Age) %>%
  summarise(
    Numero_Estudiantes_Deprimidos = sum(Depression == 1, na.rm = TRUE),
    Numero_Estudiantes_No_Deprimidos = sum(Depression == 0, na.rm = TRUE)
  ) %>%
  mutate(
    Total = Numero_Estudiantes_Deprimidos + Numero_Estudiantes_No_Deprimidos,
    Porcentaje_Deprimidos = 100 * Numero_Estudiantes_Deprimidos / Total,
    Porcentaje_No_Deprimidos = 100 * Numero_Estudiantes_No_Deprimidos / Total
  )

depresion_por_edad


depresion_long <- depresion_por_edad %>%
  mutate(Total = Numero_Estudiantes_Deprimidos + Numero_Estudiantes_No_Deprimidos) %>%  # opcional, ya la tienes
  pivot_longer(
    cols = c(Porcentaje_Deprimidos, Porcentaje_No_Deprimidos),
    names_to = "Estado",
    values_to = "Porcentaje"
  ) %>%
  mutate(
    Estado = recode(Estado,
                    Porcentaje_Deprimidos = "Deprimidos",
                    Porcentaje_No_Deprimidos = "No Deprimidos")
  )

# Gráfico de barras apiladas
ggplot(depresion_long, aes(x = Age, y = Porcentaje, fill = Estado)) +
  geom_col() +
  labs(
    title = "Porcentaje de estudiantes deprimidos por edad",
    x = "Edad",
    y = "Porcentaje (%)"
  ) +
  scale_fill_manual(values = c("Deprimidos" = "red", "No Deprimidos" = "green")) +
  theme_minimal()
  
```

