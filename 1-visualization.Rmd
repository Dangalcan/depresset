---
title: "Depresset. Grupo 5. Visualización"
author: "Daniel Galván Cancio, Daniel Vela Camacho, Jaime Linares Barrera, Miguel Encina Martinez"
output: html_document
---

## Dataset escogido

Student depression: https://www.kaggle.com/datasets/adilshamim8/student-depression-dataset


# Proyecto sobre la depresión estudiantil

```{r}
  library(readr)
  library(tidyr)
  library(tidyverse)
  library(dplyr)
  library(ggplot2)
  library(lubridate)
  library(gapminder)
  library(plotly)

```


```{r}
  # leer el csv
  ds <- read.csv("./data/student_depression_dataset.csv",sep=",")
  head(ds)
  dim(ds)

```

## Depresión por sexo

```{r}

  depresion_por_sexo <- ds %>%
  group_by(Gender) %>%
  summarise(
    Numero_Estudiantes_Deprimidos = sum(Depression == 1, na.rm = TRUE),
    Numero_Estudiantes_No_Deprimidos = sum(Depression == 0, na.rm = TRUE)
  ) %>%
  mutate(
    Total = Numero_Estudiantes_Deprimidos + Numero_Estudiantes_No_Deprimidos,
    Porcentaje_Deprimidos = 100 * Numero_Estudiantes_Deprimidos / Total,
    Porcentaje_No_Deprimidos = 100 * Numero_Estudiantes_No_Deprimidos / Total
  )

  depresion_por_sexo_masculino <- depresion_por_sexo %>%
    filter(Gender == "Male")

  depresion_por_sexo_femenino <- depresion_por_sexo %>%
    filter(Gender == "Female")

  # Pie chart de varones deprimidos vs no deprimidos
  plot_ly(depresion_por_sexo_masculino, labels = ~c('Deprimidos', 'No Deprimidos'),
          values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
          textposition = 'inside',
          textinfo = 'label+percent') %>%
    layout(title = 'Estudiantes Masculinos Deprimidos vs No Deprimidos',
          xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
          yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

  # Pie chart de mujeres deprimidas vs no deprimidas
  plot_ly(depresion_por_sexo_femenino, labels = ~c('Deprimidos', 'No Deprimidos'),
          values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
          textposition = 'inside',
          textinfo = 'label+percent') %>%
    layout(title = 'Estudiantes Femeninos Deprimidos vs No Deprimidos',
          xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
          yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))


  # Pie chart de porcentaje de estudiantes deprimidos por género
  plot_ly(depresion_por_sexo, labels = ~Gender, values = ~Porcentaje_Deprimidos, type = 'pie',
          textposition = 'inside',
          textinfo = 'label+percent') %>%
    layout(title = 'Porcentaje de Estudiantes Deprimidos por Género',
          xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
          yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

```

## Depresión por profesión

```{r}

profesions <- ds %>%
  group_by(Profession) %>%
  summarise(Count = n())

profesions

ggplot(profesions, aes(x = reorder(Profession, -Count), y = Count)) +
  geom_bar(stat = "identity", fill = "coral") +
  labs(title = "Número de Personas por Profesión",
       x = "Profesión",
       y = "Número de Personas") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

## Depresión por ciudad

```{r}

depresion_por_ciudades <- ds %>%
  filter(Depression == 1 & Profession == "Student") %>%
  group_by(City) %>%
  summarise(Numero_Estudiantes_Deprimidos = n()) %>%
  arrange(desc(Numero_Estudiantes_Deprimidos))

depresion_por_ciudades

ggplot(depresion_por_ciudades, aes(x = reorder(City, -Numero_Estudiantes_Deprimidos), y = Numero_Estudiantes_Deprimidos)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(title = "Ciudades con más Estudiantes Deprimidos",
       x = "Ciudad",
       y = "Número de Estudiantes Deprimidos") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```
## Depresión por sexo en estudiantes

```{r}
depresion_por_sexo <- ds %>%
  filter(Profession == "Student") %>%
  group_by(Gender) %>%
  summarise(
    Numero_Estudiantes_Deprimidos = sum(Depression == 1, na.rm = TRUE),
    Numero_Estudiantes_No_Deprimidos = sum(Depression == 0, na.rm = TRUE)
  ) %>%
  mutate(
    Total = Numero_Estudiantes_Deprimidos + Numero_Estudiantes_No_Deprimidos,
    Porcentaje_Deprimidos = 100 * Numero_Estudiantes_Deprimidos / Total,
    Porcentaje_No_Deprimidos = 100 * Numero_Estudiantes_No_Deprimidos / Total
  )

depresion_por_sexo
```

## Depresión por nivel de estudios en estudiantes

Hemos encontrado que la variable nivel de estudios tiene distintos valores, por lo que en el preprocesado deberemos abordar esto unificando unos valores categóricos con orden

```{r}

depresion_por_nivel_estudio <- ds %>%
  filter(Profession == "Student") %>%
  group_by(Degree) %>%
  summarise(
    Numero_Estudiantes_Deprimidos = sum(Depression == 1, na.rm = TRUE),
    Numero_Estudiantes_No_Deprimidos = sum(Depression == 0, na.rm = TRUE)
  ) %>%
  mutate(
    Total = Numero_Estudiantes_Deprimidos + Numero_Estudiantes_No_Deprimidos,
    Porcentaje_Deprimidos = 100 * Numero_Estudiantes_Deprimidos / Total,
    Porcentaje_No_Deprimidos = 100 * Numero_Estudiantes_No_Deprimidos / Total
  )
  
depresion_por_nivel_estudio
```
# Depresión por edad 

```{r}
depresion_por_edad <- ds %>%
  filter(Profession == "Student") %>%
  group_by(Age) %>%
  summarise(
    Numero_Estudiantes_Deprimidos = sum(Depression == 1, na.rm = TRUE),
    Numero_Estudiantes_No_Deprimidos = sum(Depression == 0, na.rm = TRUE)
  ) %>%
  mutate(
    Total = Numero_Estudiantes_Deprimidos + Numero_Estudiantes_No_Deprimidos,
    Porcentaje_Deprimidos = 100 * Numero_Estudiantes_Deprimidos / Total,
    Porcentaje_No_Deprimidos = 100 * Numero_Estudiantes_No_Deprimidos / Total
  )

depresion_por_edad


depresion_long <- depresion_por_edad %>%
  mutate(Total = Numero_Estudiantes_Deprimidos + Numero_Estudiantes_No_Deprimidos) %>%  # opcional, ya la tienes
  pivot_longer(
    cols = c(Porcentaje_Deprimidos, Porcentaje_No_Deprimidos),
    names_to = "Estado",
    values_to = "Porcentaje"
  ) %>%
  mutate(
    Estado = recode(Estado,
                    Porcentaje_Deprimidos = "Deprimidos",
                    Porcentaje_No_Deprimidos = "No Deprimidos")
  )

# Gráfico de barras apiladas
ggplot(depresion_long, aes(x = Age, y = Porcentaje, fill = Estado)) +
  geom_col() +
  labs(
    title = "Porcentaje de estudiantes deprimidos por edad",
    x = "Edad",
    y = "Porcentaje (%)"
  ) +
  scale_fill_manual(values = c("Deprimidos" = "red", "No Deprimidos" = "green")) +
  theme_minimal()
  
```

## Depresión por horas de sueño

```{r}
  depresion_por_horas_sueño <- ds %>%
  filter(Profession == "Student") %>%
  group_by(Sleep.Duration) %>%
  summarise(
    Numero_Estudiantes_Deprimidos = sum(Depression == 1, na.rm = TRUE),
    Numero_Estudiantes_No_Deprimidos = sum(Depression == 0, na.rm = TRUE)
  ) %>%
  mutate(
    Total = Numero_Estudiantes_Deprimidos + Numero_Estudiantes_No_Deprimidos,
    Porcentaje_Deprimidos = 100 * Numero_Estudiantes_Deprimidos / Total,
    Porcentaje_No_Deprimidos = 100 * Numero_Estudiantes_No_Deprimidos / Total
  )
depresion_por_horas_sueño
```
## Depresión por nivel de estudios 

```{r}
depresion_por_nivel_estudio <- ds %>%
  filter(Profession == "Student") %>%
  group_by(Age) %>%
  summarise(
    Numero_Estudiantes_Deprimidos = sum(Depression == 1, na.rm = TRUE),
    Numero_Estudiantes_No_Deprimidos = sum(Depression == 0, na.rm = TRUE)
  ) %>%
  mutate(
    Total = Numero_Estudiantes_Deprimidos + Numero_Estudiantes_No_Deprimidos,
    Porcentaje_Deprimidos = 100 * Numero_Estudiantes_Deprimidos / Total,
    Porcentaje_No_Deprimidos = 100 * Numero_Estudiantes_No_Deprimidos / Total
  )
  
depresion_por_nivel_estudio

depresion_por_nivel_estudio <- ds %>%
  filter(Profession == "Student") %>%
  group_by(Degree) %>%
  summarise(
    Numero_Estudiantes_Deprimidos = sum(Depression == 1, na.rm = TRUE),
    Numero_Estudiantes_No_Deprimidos = sum(Depression == 0, na.rm = TRUE)
  ) %>%
  mutate(
    Total = Numero_Estudiantes_Deprimidos + Numero_Estudiantes_No_Deprimidos,
    Porcentaje_Deprimidos = 100 * Numero_Estudiantes_Deprimidos / Total,
    Porcentaje_No_Deprimidos = 100 * Numero_Estudiantes_No_Deprimidos / Total
  )
  
depresion_por_nivel_estudio

# Grafico de barras del numero de estudiantes deprimidos por nivel de estudio
ggplot(depresion_por_nivel_estudio, aes(x = reorder(Degree, -Numero_Estudiantes_Deprimidos), y = Numero_Estudiantes_Deprimidos)) +
  geom_bar(stat = "identity", fill = "purple") +
  labs(title = "Número de Estudiantes Deprimidos por Nivel de Estudio",
       x = "Nivel de Estudio",
       y = "Número de Estudiantes Deprimidos") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# pie chart de cada nivel de estudio con porcentaje de estudiantes deprimidos
# Class 12
depresion_por_class12 <- depresion_por_nivel_estudio %>%
  filter(Degree == "'Class 12'")

depresion_por_class12

plot_ly(depresion_por_class12, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de Class 12 Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#B.Arch
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "B.Arch")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de B.Arch Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#B.Com
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "B.Com")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de B.Com Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#B.Ed
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "B.Ed")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de B.Ed Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#B.Pharm
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "B.Pharm")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de B.Pharm Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#B.Tech
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "B.Tech")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de B.Tech Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#BA
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "BA")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de BA Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#BBA
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "BBA")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de BBA Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#BCA
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "BCA")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de BCA Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#BE
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "BE")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de BE Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#BHM
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "BHM")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de BHM Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#BSc
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "BSc")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de BSc Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#LLB
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "LLB")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de LLB Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#LLM
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "LLM")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de LLM Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#M.Com
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "M.Com")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de M.Com Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#M.Ed
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "M.Ed")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de M.Ed Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#M.Pharm
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "M.Pharm")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de M.Pharm Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#M.Tech
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "M.Tech")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de M.Tech Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#MA
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "MA")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de MA Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#MBA
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "MBA")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de MBA Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#MBBS
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "MBBS")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de MBBS Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#MCA
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "MCA")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de MCA Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#MD
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "MD")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de MD Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#ME
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "ME")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de ME Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#MHM
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "MHM")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de MHM Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#MSc
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "MSc")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de MSc Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#Others
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "Others")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de Others Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#PhD
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "PhD")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de PhD Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))
  
```

```{r}
# Scatterplot para ver la  relación entre el rendimiento académico, la satisfacción académica y la depresión
# Primero, crea la variable Depresion_bin
df_procesado <- ds %>%
  dplyr::mutate(
    Depresion_bin = ifelse(!is.na(Depression), as.character(Depression),
      ifelse(!is.na(Depression.Score) & Depression.Score >= 10, "1", "0")
    ),
    Depresion_bin = factor(Depresion_bin, levels = c("0", "1"), labels = c("No", "Sí"))
  )

# Luego, crea el gráfico (en un bloque SEPARADO)
ggplot(df_procesado, aes(x = CGPA, y = Study.Satisfaction, color = Depresion_bin, shape = Depresion_bin)) +
  geom_point(size = 3, alpha = 0.8, na.rm = TRUE) +
  scale_color_manual(values = c("No" = "#1f77b4", "Sí" = "#d62728")) +
  scale_shape_manual(values = c("No" = 16, "Sí" = 17)) +
  labs(
    title = "CGPA vs Satisfacción según Depresión",
    x = "CGPA",
    y = "Study Satisfaction",
    color = "Depresión",
    shape = "Depresión"
  ) +
  theme_minimal()
```