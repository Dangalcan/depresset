---
title: "Estudio sobre la depresión estudiantil. Grupo 5. Visualización"
author: "Miguel Encina Martinez, Daniel Galván Cancio, Jaime Linares Barrera, Daniel Vela Camacho"
output: html_document
---

# Estudio sobre la depresión estudiantil

La salud mental estudiantil se ha convertido en una de las principales preocupaciones dentro del ámbito académico y social en los últimos años. La presión por obtener buenos resultados, la inestabilidad emocional propia de la etapa formativa, la carga de trabajo, el estrés, la falta de apoyo y otros factores externos han provocado que la depresión en estudiantes aumente de forma notable. Comprender las causas, patrones y factores asociados a este fenómeno resulta fundamental tanto para diseñar programas de prevención como para desarrollar intervenciones tempranas que mejoren el bienestar del alumnado.

El estudio de la depresión estudiantil mediante técnicas de análisis de datos permite identificar tendencias que no siempre son evidentes a simple vista. A través de la exploración y modelización de datos podemos descubrir relaciones entre variables, detectar perfiles de riesgo y analizar el impacto de ciertos hábitos o situaciones personales sobre la salud mental. Este proyecto tiene como objetivo profundizar en dichos aspectos utilizando un conjunto de datos real y aplicar herramientas propias de la ingeniería de datos para obtener conclusiones fundamentadas.

A lo largo de los distintos notebooks que componen este trabajo realizaremos una exploración completa del dataset, empezando por una visualización inicial, pasando por procesos de limpieza y preprocesamiento y, finalmente, aplicando técnicas de aprendizaje supervisado y no supervisado que nos permitirán extraer conocimiento de forma rigurosa. El propósito final no es únicamente obtener resultados numéricos, sino también reflexionar sobre cómo el análisis de datos puede contribuir a mejorar la detección y comprensión de problemas de salud mental en entornos educativos.

Para llevar a cabo este estudio hemos utilizado unos datos de la plataforma [Kaggle](https://www.kaggle.com/) que pueden acceder a través del seguiente enlace: <https://www.kaggle.com/datasets/adilshamim8/student-depression-dataset>

# Visualización

En este cuaderno nos centraremos exclusivamente en la fase de **visualización de los datos**. Esta etapa es imprescindible antes de abordar cualquier proceso analítico más complejo, ya que permite comprender la estructura del dataset, detectar posibles valores anómalos, identificar distribuciones relevantes y observar relaciones entre variables. Una buena visualización inicial nos ayuda a formular hipótesis, seleccionar técnicas adecuadas para el modelado posterior y, en general, a entender mejor el problema al que nos enfrentamos.

A través de distintos gráficos y transformaciones básicas analizaremos tanto variables numéricas como categóricas, exploraremos patrones y estudiaremos visualmente qué factores podrían estar asociados a mayores niveles de depresión en estudiantes. Esta primera aproximación servirá de base para los siguientes notebooks, donde continuaremos profundizando en la calidad de los datos, su preprocesamiento y su uso en algoritmos de aprendizaje automático.

Antes de comenzar, vamos a importar las librerías que nos van a hacer falta en este notebook.

```{r}
#install.packages("ggplot2")
library(ggplot2)

#install.packages("patchwork")
library(patchwork)

#install.packages("dplyr")
library(dplyr)

#library(readr)
#library(tidyr)
#library(tidyverse)
#library(lubridate)
#library(gapminder)
#library(plotly)
```

## 1. Lectura del dataset

Leemos el archivo CSV `student_depression_dataset` que se encuentra en la carpeta `data`.

```{r}
data <- read.csv("./data/student_depression_dataset.csv", sep=",")
head(data)
```

Obtenemos una descripción más clara de su estructura interna: tipos de variables, número de columnas, categorías en variables cualitativas, etc.

```{r}
str(data)
```

Obtenemos una primera descripción general del conjunto de datos.

```{r}
summary(data)
```

Detectamos si existen valores faltantes en el conjunto de datos.

```{r}
colSums(is.na(data))
```

## 2. Exploración univariante

En esta sección realizaremos un análisis individual de cada variable del dataset con el objetivo de comprender su distribución y características principales antes de estudiar relaciones más complejas.

Antes de comenzar con las representaciones gráficas, realizamos algunos pasos previos de preparación.

### 2.1. Limpieza inicial y selección de variables útiles

La columna `Profession` indica la ocupación del participante. Dado que prácticamente todos los registros corresponden a estudiantes, filtramos únicamente aquellas observaciones donde `Profession == "Student"`. Una vez realizado el filtrado, esta variable deja de aportar información, por lo que la eliminamos junto con otras columnas que tampoco resultan útiles para el análisis:

-   `id`: identificador sin utilidad analítica.
-   `Work.Pressure`: constante en estudiantes (valor 0 en todos los casos).
-   `Job.Satisfaction`: constante en estudiantes (valor 0 en todos los casos).

```{r}
data <- subset(data, Profession == "Student")
data <- data[, !(names(data) %in% c("Profession", "Work.Pressure", "id", "Job.Satisfaction")) ]
head(data)
```

### 2.2 Identificación de variables numéricas y categóricas

Tras la limpieza, realizamos una clasificación manual de las variables según su naturaleza real. Esto es importante porque algunas aparecen como numéricas pero representan categorías (por ejemplo, variables booleanas).

```{r}
numeric_vars <- c(
  "Age",
  "Academic.Pressure",
  "CGPA",
  "Study.Satisfaction",
  "Work.Study.Hours"
)

categorical_vars <- c(
  "Gender",
  "City",
  "Sleep.Duration",
  "Dietary.Habits",
  "Degree",
  "Have.you.ever.had.suicidal.thoughts..",
  "Financial.Stress",
  "Family.History.of.Mental.Illness",
  "Depression"
)
```

### 2.3. Exploración univariante de variables numéricas

Para analizar la distribución de las variables numéricas del dataset utilizamos histogramas y boxplots. Estos gráficos permiten visualizar de manera clara la forma de la distribución, la presencia de valores extremos y el rango de cada variable.

A continuación generamos para cada variable un **histograma** y un **boxplot**:

```{r}
for (var in numeric_vars) {
  # histograma
  p1 <- ggplot(data, aes(x = .data[[var]])) +
    geom_histogram(bins = 20, fill = "#69b3a2", color = "white") +
    labs(x = var, y = "Frecuencia")
  # boxplot
  p2 <- ggplot(data, aes(y = .data[[var]])) +
    geom_boxplot(fill = "#FFBF00") +
    labs(y = var)
  # hist + boxplot
  print(
    (p1 | p2) +
      plot_annotation(
        title = paste("Visualización univariante de", var),
        theme = theme(plot.title = element_text(hjust = 0.5))
      )
  )
}
```

### 2.4. Exploración univariante de variables categóricas

Las variables categóricas representan grupos, respuestas o niveles, por lo que resulta fundamental analizar la frecuencia con la que aparece cada categoría. Esto nos permite detectar desbalances importantes, categorías poco representadas o patrones interesantes en la distribución de respuestas.

Dependiendo del número de categorías que tenga cada variable, utilizamos dos tipos de visualizaciones:

-   **Diagrama de sectores** (pie chart) cuando la variable tiene seis o menos categorías, ya que permite observar con claridad las proporciones relativas.

-   **Diagrama de barras** cuando la variable posee más de seis categorías, evitando gráficos circulares difíciles de interpretar y asegurando una lectura más clara.

```{r}
for (var in categorical_vars) {
  # num categorías de la variable
  n_cats <- length(unique(data[[var]]))
  # pie chart (si <= 6 niveles), sino diagrama de barras
  if (n_cats <= 6) {
    df <- data %>%
      group_by(.data[[var]]) %>%
      summarise(freq = n()) %>%
      mutate(
        prop = freq / sum(freq),
        Label = paste0(round(prop * 100), "%")
      )
    
    p <- ggplot(df, aes(x = "", y = prop, fill = .data[[var]])) +
      geom_col(color = "white") +
      geom_label(
        aes(label = Label), 
        position = position_stack(vjust = 0.5),
        show.legend = FALSE
      ) +
      coord_polar(theta = "y") +
      labs(
        title = paste("Distribución de", var),
        fill = var
      ) +
      theme_void() +
      theme(plot.title = element_text(hjust = 0.5))
    
    print(p)
    
  } else {
    p <- ggplot(data, aes(x = .data[[var]])) +
      geom_bar(fill = "#6495ED") +
      labs(
        title = paste("Distribución de", var),
        x = var,
        y = "Frecuencia"
      ) +
      theme(
        axis.text.x = element_text(angle = 90, hjust = 1),
        plot.title = element_text(hjust = 0.5)
      )
    
    print(p)
  }
}
```

## 3. Exploración bivariante






### Depresión por sexo

```{r}

  depresion_por_sexo <- data %>%
  group_by(Gender) %>%
  summarise(
    Numero_Estudiantes_Deprimidos = sum(Depression == 1, na.rm = TRUE),
    Numero_Estudiantes_No_Deprimidos = sum(Depression == 0, na.rm = TRUE)
  ) %>%
  mutate(
    Total = Numero_Estudiantes_Deprimidos + Numero_Estudiantes_No_Deprimidos,
    Porcentaje_Deprimidos = 100 * Numero_Estudiantes_Deprimidos / Total,
    Porcentaje_No_Deprimidos = 100 * Numero_Estudiantes_No_Deprimidos / Total
  )

  depresion_por_sexo_masculino <- depresion_por_sexo %>%
    filter(Gender == "Male")

  depresion_por_sexo_femenino <- depresion_por_sexo %>%
    filter(Gender == "Female")

  # Pie chart de varones deprimidos vs no deprimidos
  plot_ly(depresion_por_sexo_masculino, labels = ~c('Deprimidos', 'No Deprimidos'),
          values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
          textposition = 'inside',
          textinfo = 'label+percent') %>%
    layout(title = 'Estudiantes Masculinos Deprimidos vs No Deprimidos',
          xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
          yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

  # Pie chart de mujeres deprimidas vs no deprimidas
  plot_ly(depresion_por_sexo_femenino, labels = ~c('Deprimidos', 'No Deprimidos'),
          values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
          textposition = 'inside',
          textinfo = 'label+percent') %>%
    layout(title = 'Estudiantes Femeninos Deprimidos vs No Deprimidos',
          xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
          yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))


  # Pie chart de porcentaje de estudiantes deprimidos por género
  plot_ly(depresion_por_sexo, labels = ~Gender, values = ~Porcentaje_Deprimidos, type = 'pie',
          textposition = 'inside',
          textinfo = 'label+percent') %>%
    layout(title = 'Porcentaje de Estudiantes Deprimidos por Género',
          xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
          yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

```

### Depresión por ciudad

```{r}

depresion_por_ciudades <- data %>%
  filter(Depression == 1 & Profession == "Student") %>%
  group_by(City) %>%
  summarise(Numero_Estudiantes_Deprimidos = n()) %>%
  arrange(desc(Numero_Estudiantes_Deprimidos))

depresion_por_ciudades

ggplot(depresion_por_ciudades, aes(x = reorder(City, -Numero_Estudiantes_Deprimidos), y = Numero_Estudiantes_Deprimidos)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(title = "Ciudades con más Estudiantes Deprimidos",
       x = "Ciudad",
       y = "Número de Estudiantes Deprimidos") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```


### Depresión por nivel de estudios en estudiantes

Hemos encontrado que la variable nivel de estudios tiene distintos valores, por lo que en el preprocesado deberemos abordar esto unificando unos valores categóricos con orden

```{r}

depresion_por_nivel_estudio <- data %>%
  filter(Profession == "Student") %>%
  group_by(Degree) %>%
  summarise(
    Numero_Estudiantes_Deprimidos = sum(Depression == 1, na.rm = TRUE),
    Numero_Estudiantes_No_Deprimidos = sum(Depression == 0, na.rm = TRUE)
  ) %>%
  mutate(
    Total = Numero_Estudiantes_Deprimidos + Numero_Estudiantes_No_Deprimidos,
    Porcentaje_Deprimidos = 100 * Numero_Estudiantes_Deprimidos / Total,
    Porcentaje_No_Deprimidos = 100 * Numero_Estudiantes_No_Deprimidos / Total
  )
  
depresion_por_nivel_estudio
```

### Depresión por edad

```{r}
depresion_por_edad <- data %>%
  filter(Profession == "Student") %>%
  group_by(Age) %>%
  summarise(
    Numero_Estudiantes_Deprimidos = sum(Depression == 1, na.rm = TRUE),
    Numero_Estudiantes_No_Deprimidos = sum(Depression == 0, na.rm = TRUE)
  ) %>%
  mutate(
    Total = Numero_Estudiantes_Deprimidos + Numero_Estudiantes_No_Deprimidos,
    Porcentaje_Deprimidos = 100 * Numero_Estudiantes_Deprimidos / Total,
    Porcentaje_No_Deprimidos = 100 * Numero_Estudiantes_No_Deprimidos / Total
  )

depresion_por_edad


depresion_long <- depresion_por_edad %>%
  mutate(Total = Numero_Estudiantes_Deprimidos + Numero_Estudiantes_No_Deprimidos) %>%  # opcional, ya la tienes
  pivot_longer(
    cols = c(Porcentaje_Deprimidos, Porcentaje_No_Deprimidos),
    names_to = "Estado",
    values_to = "Porcentaje"
  ) %>%
  mutate(
    Estado = recode(Estado,
                    Porcentaje_Deprimidos = "Deprimidos",
                    Porcentaje_No_Deprimidos = "No Deprimidos")
  )

# Gráfico de barras apiladas
ggplot(depresion_long, aes(x = Age, y = Porcentaje, fill = Estado)) +
  geom_col() +
  labs(
    title = "Porcentaje de estudiantes deprimidos por edad",
    x = "Edad",
    y = "Porcentaje (%)"
  ) +
  scale_fill_manual(values = c("Deprimidos" = "red", "No Deprimidos" = "green")) +
  theme_minimal()
  
```

### Depresión por horas de sueño

```{r}
  depresion_por_horas_sueño <- data %>%
  filter(Profession == "Student") %>%
  group_by(Sleep.Duration) %>%
  summarise(
    Numero_Estudiantes_Deprimidos = sum(Depression == 1, na.rm = TRUE),
    Numero_Estudiantes_No_Deprimidos = sum(Depression == 0, na.rm = TRUE)
  ) %>%
  mutate(
    Total = Numero_Estudiantes_Deprimidos + Numero_Estudiantes_No_Deprimidos,
    Porcentaje_Deprimidos = 100 * Numero_Estudiantes_Deprimidos / Total,
    Porcentaje_No_Deprimidos = 100 * Numero_Estudiantes_No_Deprimidos / Total
  )
depresion_por_horas_sueño
```

### Depresión por nivel de estudios

```{r}
depresion_por_nivel_estudio <- data %>%
  filter(Profession == "Student") %>%
  group_by(Age) %>%
  summarise(
    Numero_Estudiantes_Deprimidos = sum(Depression == 1, na.rm = TRUE),
    Numero_Estudiantes_No_Deprimidos = sum(Depression == 0, na.rm = TRUE)
  ) %>%
  mutate(
    Total = Numero_Estudiantes_Deprimidos + Numero_Estudiantes_No_Deprimidos,
    Porcentaje_Deprimidos = 100 * Numero_Estudiantes_Deprimidos / Total,
    Porcentaje_No_Deprimidos = 100 * Numero_Estudiantes_No_Deprimidos / Total
  )
  
depresion_por_nivel_estudio

depresion_por_nivel_estudio <- data %>%
  filter(Profession == "Student") %>%
  group_by(Degree) %>%
  summarise(
    Numero_Estudiantes_Deprimidos = sum(Depression == 1, na.rm = TRUE),
    Numero_Estudiantes_No_Deprimidos = sum(Depression == 0, na.rm = TRUE)
  ) %>%
  mutate(
    Total = Numero_Estudiantes_Deprimidos + Numero_Estudiantes_No_Deprimidos,
    Porcentaje_Deprimidos = 100 * Numero_Estudiantes_Deprimidos / Total,
    Porcentaje_No_Deprimidos = 100 * Numero_Estudiantes_No_Deprimidos / Total
  )
  
depresion_por_nivel_estudio

# Grafico de barras del numero de estudiantes deprimidos por nivel de estudio
ggplot(depresion_por_nivel_estudio, aes(x = reorder(Degree, -Numero_Estudiantes_Deprimidos), y = Numero_Estudiantes_Deprimidos)) +
  geom_bar(stat = "identity", fill = "purple") +
  labs(title = "Número de Estudiantes Deprimidos por Nivel de Estudio",
       x = "Nivel de Estudio",
       y = "Número de Estudiantes Deprimidos") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# pie chart de cada nivel de estudio con porcentaje de estudiantes deprimidos
# Class 12
depresion_por_class12 <- depresion_por_nivel_estudio %>%
  filter(Degree == "'Class 12'")

depresion_por_class12

plot_ly(depresion_por_class12, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de Class 12 Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#B.Arch
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "B.Arch")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de B.Arch Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#B.Com
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "B.Com")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de B.Com Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#B.Ed
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "B.Ed")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de B.Ed Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#B.Pharm
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "B.Pharm")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de B.Pharm Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#B.Tech
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "B.Tech")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de B.Tech Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#BA
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "BA")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de BA Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#BBA
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "BBA")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de BBA Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#BCA
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "BCA")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de BCA Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#BE
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "BE")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de BE Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#BHM
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "BHM")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de BHM Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#BSc
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "BSc")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de BSc Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#LLB
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "LLB")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de LLB Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#LLM
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "LLM")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de LLM Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#M.Com
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "M.Com")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de M.Com Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#M.Ed
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "M.Ed")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de M.Ed Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#M.Pharm
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "M.Pharm")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de M.Pharm Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#M.Tech
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "M.Tech")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de M.Tech Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#MA
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "MA")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de MA Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#MBA
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "MBA")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de MBA Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#MBBS
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "MBBS")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de MBBS Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#MCA
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "MCA")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de MCA Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#MD
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "MD")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de MD Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#ME
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "ME")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de ME Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#MHM
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "MHM")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de MHM Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#MSc
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "MSc")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de MSc Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#Others
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "Others")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de Others Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

#PhD
depresion_por_barch <- depresion_por_nivel_estudio %>%
  filter(Degree == "PhD")

depresion_por_barch

plot_ly(depresion_por_barch, labels = ~c('Deprimidos', 'No Deprimidos'),
        values = ~c(Numero_Estudiantes_Deprimidos, Numero_Estudiantes_No_Deprimidos), type = 'pie',
        textposition = 'inside',
        textinfo = 'label+percent') %>%
  layout(title = 'Estudiantes de PhD Deprimidos vs No Deprimidos',
        xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
        yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))
  
```

```{r}
# Scatterplot para ver la  relación entre el rendimiento académico, la satisfacción académica y la depresión
# Primero, crea la variable Depresion_bin
data_procesado <- data %>%
  dplyr::mutate(
    Depresion_bin = ifelse(!is.na(Depression), as.character(Depression),
      ifelse(!is.na(Depression.Score) & Depression.Score >= 10, "1", "0")
    ),
    Depresion_bin = factor(Depresion_bin, levels = c("0", "1"), labels = c("No", "Sí"))
  )

# Luego, crea el gráfico (en un bloque SEPARADO)
ggplot(data_procesado, aes(x = CGPA, y = Study.Satisfaction, color = Depresion_bin, shape = Depresion_bin)) +
  geom_point(size = 3, alpha = 0.8, na.rm = TRUE) +
  scale_color_manual(values = c("No" = "#1f77b4", "Sí" = "#d62728")) +
  scale_shape_manual(values = c("No" = 16, "Sí" = 17)) +
  labs(
    title = "CGPA vs Satisfacción según Depresión",
    x = "CGPA",
    y = "Study Satisfaction",
    color = "Depresión",
    shape = "Depresión"
  ) +
  theme_minimal()
```
