---
title: "Estudio sobre la depresión estudiantil. Grupo 5. Visualización"
author: "Miguel Encina Martinez, Daniel Galván Cancio, Jaime Linares Barrera, Daniel Vela Camacho"
output: html_document
---

# Estudio sobre la depresión estudiantil

La salud mental estudiantil se ha convertido en una de las principales preocupaciones dentro del ámbito académico y social en los últimos años. La presión por obtener buenos resultados, la inestabilidad emocional propia de la etapa formativa, la carga de trabajo, el estrés, la falta de apoyo y otros factores externos han provocado que la depresión en estudiantes aumente de forma notable. Comprender las causas, patrones y factores asociados a este fenómeno resulta fundamental tanto para diseñar programas de prevención como para desarrollar intervenciones tempranas que mejoren el bienestar del alumnado.

El estudio de la depresión estudiantil mediante técnicas de análisis de datos permite identificar tendencias que no siempre son evidentes a simple vista. A través de la exploración y modelización de datos podemos descubrir relaciones entre variables, detectar perfiles de riesgo y analizar el impacto de ciertos hábitos o situaciones personales sobre la salud mental. Este proyecto tiene como objetivo profundizar en dichos aspectos utilizando un conjunto de datos real y aplicar herramientas propias de la ingeniería de datos para obtener conclusiones fundamentadas.

A lo largo de los distintos notebooks que componen este trabajo realizaremos una exploración completa del dataset, empezando por una visualización inicial, pasando por procesos de limpieza y preprocesamiento y, finalmente, aplicando técnicas de aprendizaje supervisado y no supervisado que nos permitirán extraer conocimiento de forma rigurosa. El propósito final no es únicamente obtener resultados numéricos, sino también reflexionar sobre cómo el análisis de datos puede contribuir a mejorar la detección y comprensión de problemas de salud mental en entornos educativos.

Para llevar a cabo este estudio hemos utilizado unos datos de la plataforma [Kaggle](https://www.kaggle.com/) que pueden acceder a través del seguiente enlace: <https://www.kaggle.com/datasets/adilshamim8/student-depression-dataset>

# Visualización

En este cuaderno nos centraremos exclusivamente en la fase de **visualización de los datos**. Esta etapa es imprescindible antes de abordar cualquier proceso analítico más complejo, ya que permite comprender la estructura del dataset, detectar posibles valores anómalos, identificar distribuciones relevantes y observar relaciones entre variables. Una buena visualización inicial nos ayuda a formular hipótesis, seleccionar técnicas adecuadas para el modelado posterior y, en general, a entender mejor el problema al que nos enfrentamos.

A través de distintos gráficos y transformaciones básicas analizaremos tanto variables numéricas como categóricas, exploraremos patrones y estudiaremos visualmente qué factores podrían estar asociados a mayores niveles de depresión en estudiantes. Esta primera aproximación servirá de base para los siguientes notebooks, donde continuaremos profundizando en la calidad de los datos, su preprocesamiento y su uso en algoritmos de aprendizaje automático.

Antes de comenzar, vamos a importar las librerías que nos van a hacer falta en este notebook.

```{r}
#install.packages("ggplot2")
library(ggplot2)

#install.packages("patchwork")
library(patchwork)

#install.packages("dplyr")
library(dplyr)

#install.packages("corrplot")
library(corrplot)
```

## 1. Lectura del dataset

Leemos el archivo CSV `student_depression_dataset` que se encuentra en la carpeta `data`.

```{r}
data <- read.csv("./data/student_depression_dataset.csv", sep=",")
head(data)
```

Obtenemos una descripción más clara de su estructura interna: tipos de variables, número de columnas, categorías en variables cualitativas, etc.

```{r}
str(data)
```

Obtenemos una primera descripción general del conjunto de datos.

```{r}
summary(data)
```

Detectamos si existen valores faltantes en el conjunto de datos.

```{r}
colSums(is.na(data))
```

## 2. Exploración univariante

En esta sección realizaremos un análisis individual de cada variable del dataset con el objetivo de comprender su distribución y características principales antes de estudiar relaciones más complejas.

Antes de comenzar con las representaciones gráficas, realizamos algunos pasos previos de preparación.

### 2.1. Limpieza inicial y selección de variables útiles

La columna `Profession` indica la ocupación del participante. Dado que prácticamente todos los registros corresponden a estudiantes, filtramos únicamente aquellas observaciones donde `Profession == "Student"`. Una vez realizado el filtrado, esta variable deja de aportar información, por lo que la eliminamos junto con otras columnas que tampoco resultan útiles para el análisis:

-   `id`: identificador sin utilidad analítica.
-   `Work.Pressure`: constante en estudiantes (valor 0 en todos los casos).
-   `Job.Satisfaction`: constante en estudiantes (valor 0 en todos los casos).

```{r}
data <- subset(data, Profession == "Student")
data <- data[, !(names(data) %in% c("Profession", "Work.Pressure", "id", "Job.Satisfaction")) ]
head(data)
```

### 2.2 Identificación de variables numéricas y categóricas

Tras la limpieza, realizamos una clasificación manual de las variables según su naturaleza real. Esto es importante porque algunas aparecen como numéricas pero representan categorías (por ejemplo, variables booleanas).

```{r}
numeric_vars <- c(
  "Age",
  "Academic.Pressure",
  "CGPA",
  "Study.Satisfaction",
  "Work.Study.Hours"
)

categorical_vars <- c(
  "Gender",
  "City",
  "Sleep.Duration",
  "Dietary.Habits",
  "Degree",
  "Have.you.ever.had.suicidal.thoughts..",
  "Financial.Stress",
  "Family.History.of.Mental.Illness",
  "Depression"
)
```

### 2.3. Exploración univariante de variables numéricas

Para analizar la distribución de las variables numéricas del dataset utilizamos histogramas y boxplots. Estos gráficos permiten visualizar de manera clara la forma de la distribución, la presencia de valores extremos y el rango de cada variable.

A continuación generamos para cada variable un **histograma** y un **boxplot**:

```{r}
for (var in numeric_vars) {
  # histograma
  p1 <- ggplot(data, aes(x = .data[[var]])) +
    geom_histogram(bins = 20, fill = "#69b3a2", color = "white") +
    labs(x = var, y = "Frecuencia")
  # boxplot
  p2 <- ggplot(data, aes(y = .data[[var]])) +
    geom_boxplot(fill = "#FFBF00") +
    labs(y = var)
  # hist + boxplot
  print(
    (p1 | p2) +
      plot_annotation(
        title = paste("Visualización univariante de", var),
        theme = theme(plot.title = element_text(hjust = 0.5))
      )
  )
}
```

### 2.4. Exploración univariante de variables categóricas

Las variables categóricas representan grupos, respuestas o niveles, por lo que resulta fundamental analizar la frecuencia con la que aparece cada categoría. Esto nos permite detectar desbalances importantes, categorías poco representadas o patrones interesantes en la distribución de respuestas.

Dependiendo del número de categorías que tenga cada variable, utilizamos dos tipos de visualizaciones:

-   **Diagrama de sectores** (pie chart) cuando la variable tiene seis o menos categorías, ya que permite observar con claridad las proporciones relativas.

-   **Diagrama de barras** cuando la variable posee más de seis categorías, evitando gráficos circulares difíciles de interpretar y asegurando una lectura más clara.

```{r}
for (var in categorical_vars) {
  # num categorías de la variable
  n_cats <- length(unique(data[[var]]))
  # pie chart (si <= 6 niveles), sino diagrama de barras
  if (n_cats <= 6) {
    df <- data %>%
      group_by(.data[[var]]) %>%
      summarise(freq = n()) %>%
      mutate(
        prop = freq / sum(freq),
        Label = paste0(round(prop * 100), "%")
      )
    
    p <- ggplot(df, aes(x = "", y = prop, fill = .data[[var]])) +
      geom_col(color = "white") +
      geom_label(
        aes(label = Label), 
        position = position_stack(vjust = 0.5),
        show.legend = FALSE
      ) +
      coord_polar(theta = "y") +
      labs(
        title = paste("Distribución de", var),
        fill = var
      ) +
      theme_void() +
      theme(plot.title = element_text(hjust = 0.5))
    
    print(p)
    
  } else {
    p <- ggplot(data, aes(x = .data[[var]])) +
      geom_bar(fill = "#6495ED") +
      labs(
        title = paste("Distribución de", var),
        x = var,
        y = "Frecuencia"
      ) +
      theme(
        axis.text.x = element_text(angle = 90, hjust = 1),
        plot.title = element_text(hjust = 0.5)
      )
    
    print(p)
  }
}
```

## 3. Exploración bivariante

En esta sección analizamos la relación entre pares de variables del dataset. Mientras que en la exploración univariante nos centramos en el comportamiento individual de cada variable, aquí buscamos patrones conjuntos: cómo se relacionan entre sí las variables numéricas, cómo cambia la distribución de una variable numérica según distintas categorías y cómo se asocian distintas variables categóricas entre sí.

El objetivo principal es detectar posibles asociaciones relevantes con la variable de interés `Depression`, así como relaciones entre factores académicos, personales y de estilo de vida.

### 3.1. Relación entre variables numéricas

En primer lugar estudiamos la relación entre las variables numéricas del conjunto de datos. Esto nos permite identificar correlaciones y posibles patrones lineales o no lineales entre variables como la edad, el rendimiento académico o la satisfacción con los estudios.

#### 3.1.1. Matriz de correlación entre variables numéricas

Calculamos la matriz de correlaciones de Pearson entre las variables numéricas definidas previamente en numeric_vars:

```{r}
datos_numericos <- data[, numeric_vars] 

cor_matrix <- cor(datos_numericos) 
cor_matrix
```

```{r, fig.width=12, fig.height=8}
corrplot(
  cor_matrix,
  method = "color",
  type = "upper",
  addCoef.col = "black",
  tl.col = "black",
  tl.srt = 45
)
```

La matriz de correlaciones muestra que **no existen relaciones fuertes entre las variables analizadas**. Todas las correlaciones son muy bajas, lo que indica que factores como la edad, el rendimiento académico o las horas de estudio no presentan asociaciones significativas con la satisfacción o la presión académica.

La relación más destacable, aunque sigue siendo débil, es la existente entre presión académica y satisfacción con los estudios, con una ligera correlación negativa. Por ello, es la que resulta más interesante para analizar, y se ha estudiado en detalle en el apartado anterior.

#### 3.1.2. Relación entre la presión académica y la satisfacción con los estudios

A continuación, analizamos la relación entre la presión académica (`Academic.Pressure`) y la satisfacción con los estudios (`Study.Satisfaction`). Este tipo de representación permite observar si los niveles de presión que experimentan los estudiantes influyen en su percepción de satisfacción, así como detectar patrones o tendencias generales.

```{r}
ggplot(data, aes(x = Academic.Pressure, y = Study.Satisfaction)) +
  geom_point(alpha = 0.4) +
  geom_smooth(method = "lm", se = FALSE, color = "red") +
  labs(
    title = "Relación entre presión académica y satisfacción con los estudios",
    x = "Pressión Académica",
    y = "Study Satisfaction"
  ) +
  theme_minimal()

```

La gráfica muestra que no existe una relación clara y fuerte entre la presión académica y la satisfacción con los estudios.

La línea de regresión presenta una ligera pendiente negativa, lo que indica que, en promedio, a mayor presión académica, la satisfacción tiende a ser levemente menor, aunque el efecto es muy reducido.

En resumen: la presión académica no parece influir de manera significativa en la satisfacción de los estudiantes.

### 3.2. Relación entre variables numéricas y la depresión

En este apartado analizamos cómo varían las variables numéricas en función del estado de depresión (`Depression`). De esta forma podemos estudiar, por ejemplo, si los estudiantes con depresión tienden a tener menor rendimiento académico, menor satisfacción o diferentes patrones de horas de estudio.

Para ello representamos, mediante **boxplots**, la distribución de cada variable numérica separando entre estudiantes con y sin depresión.

```{r}
data_bi <- data %>%
  mutate(
    Depression_cat = ifelse(Depression == 1, "Depresión", "Sin depresión")
  )

for (var in numeric_vars) {
  p <- ggplot(data_bi, aes(x = Depression_cat, y = .data[[var]], fill = Depression_cat)) +
    geom_boxplot(alpha = 0.7) +
    labs(
      title = paste("Distribución de", var, "según estado de depresión"),
      x = "Estado de depresión",
      y = var,
      fill = "Depresión"
    ) +
    theme_minimal()

  print(p)
}
```

Complementaremos este análisis con **gráficos de violín** (violin plots), que son visualizaciones más avanzadas. Los violines permiten observar no solo la mediana y la dispersión, sino también la forma completa de la distribución, mostrando zonas de mayor o menor concentración de datos. Esto ofrece una perspectiva más rica y detallada que los boxplots tradicionales, especialmente útil para detectar patrones asociados a la depresión.

```{r}
for (var in numeric_vars) {
  p <- ggplot(data_bi, aes(x=Depression_cat, y=.data[[var]],fill=Depression_cat))+
    geom_violin(alpha = 0.7, color = NA) +
    geom_boxplot(width = 0.1, outlier.shape = NA, alpha = 0.7) +
    labs(title = paste("Distribución de", var, "según depresión")) +
    theme_minimal()
  print(p)
}
```

### 3.3. Relación entre variables categóricas

En este apartado analizamos la relación entre pares de variables categóricas del dataset. Este tipo de análisis permite explorar cómo se distribuyen distintos grupos dentro de cada categoría y si existen patrones relevantes entre características como el género, los hábitos de vida o factores familiares.

A diferencia de la relación con la depresión (que veremos en el siguiente apartado) aquí el objetivo es estudiar asociaciones puramente descriptivas entre variables cualitativas, de modo que podamos detectar desequilibrios, dependencias o comportamientos diferenciados entre grupos.

Como ejemplo representativo analizamos la relación entre:

-   `Gender` (género del estudiante), y

-   `Family.History.of.Mental.Illness` (si el estudiante tiene antecedentes familiares de enfermedad mental).

Utilizamos una *tabla de contingencia* para observar la distribución conjunta, seguida de un *diagrama de barras apiladas* que permite visualizar las proporciones de forma más intuitiva.

```{r}
tabla_genero_familia <- table(
  data$Gender,
  data$Family.History.of.Mental.Illness
)

tabla_genero_familia
prop.table(tabla_genero_familia, margin = 1) * 100
```

```{r}
df_genero_familia <- data %>%
  group_by(Gender, Family.History.of.Mental.Illness) %>%
  summarise(Numero = n(), .groups = "drop") %>%
  group_by(Gender) %>%
  mutate(
    Porcentaje = 100 * Numero / sum(Numero)
  )

ggplot(df_genero_familia, aes(
  x = Gender, y = Porcentaje,
  fill = Family.History.of.Mental.Illness
)) +
  geom_col() +
  labs(
    title = "Relación entre género y antecedentes familiares de enfermedad mental",
    x = "Género",
    y = "Porcentaje (%)",
    fill = "Antecedentes familiares"
  ) +
  theme_minimal()
```

### 3.4. Relación entre variables categóricas y la depresión

En este apartado nos centramos específicamente en estudiar cómo se relaciona la presencia de depresión (Depression) con distintas variables categóricas del conjunto de datos, tales como el género, las horas de sueño, los hábitos dietéticos o el nivel de estudios.

Nuestro objetivo es identificar diferencias relevantes entre grupos: ¿hay categorías con mayor proporción de estudiantes deprimidos? ¿se observan patrones consistentes según hábitos, características personales o factores académicos?

Para evitar repetir código y facilitar la creación de gráficos comparables, definimos una función genérica que:

-   Agrupa por la variable categórica de interés y por el estado de depresión.

-   Calcula el porcentaje de estudiantes deprimidos y no deprimidos dentro de cada categoría.

-   Devuelve un gráfico de barras apiladas, mostrando de forma clara las diferencias entre grupos.

De esta manera, con una sola función podemos analizar sistemáticamente *“Depresión según X”* para cualquier variable categórica del dataset.

```{r}
plot_depression_by_cat <- function(data, var_name) {
  df <- data %>%
    group_by(.data[[var_name]], Depression) %>%
    summarise(Numero = n(), .groups = "drop") %>%
    group_by(.data[[var_name]]) %>%
    mutate(
      Porcentaje = 100 * Numero / sum(Numero),
      Depression_cat = ifelse(Depression == 1, "Depresión", "Sin depresión")
    )

  ggplot(df, aes(x = .data[[var_name]], y = Porcentaje, fill = Depression_cat)) +
    geom_col() +
    labs(
      title = paste("Porcentaje de estudiantes deprimidos según", var_name),
      x = var_name,
      y = "Porcentaje (%)",
      fill = "Estado"
    ) +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 90, hjust = 1))
}
```

Variables categóricas para analizar frente a `Depression`:

```{r}
vars_dep_cat <- c(
  "Gender",
  "City",
  "Sleep.Duration",
  "Dietary.Habits",
  #"Degree",
  "Have.you.ever.had.suicidal.thoughts..",
  "Financial.Stress",
  "Family.History.of.Mental.Illness"
)

for (v in vars_dep_cat) {
  print(plot_depression_by_cat(data, v))
}
```







